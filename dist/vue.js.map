{"version":3,"file":"vue.js","sources":["../src/compile/parseAst.js","../src/compile/index.js","../src/init.js","../src/index.js"],"sourcesContent":["const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; //标签名称\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; //<span:xx>\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); //开头箭头\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 标签结束\nconst attribute =\n\t/^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 标签属性\nconst startTagClose = /^\\s*(\\/?)>/;\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\n// 创建AST语法树\nfunction creatASTElement(tag, attrs) {\n\treturn {\n\t\ttag, // 元素\n\t\tattrs, // 属性\n\t\tchildren: [], //子节点\n\t\ttype: 1,\n\t\tparent: null,\n\t};\n}\nlet root; // 跟元素\nlet creatParent; // 当前的父元素\n// 数据结构栈\nlet stack = [];\nfunction start(tag, attrs) {\n\t// 开始的标签\n\tlet element = creatASTElement(tag, attrs);\n\tif (!root) {\n\t\troot = element;\n\t}\n\tcreatParent = element;\n\tstack.push(element);\n}\nfunction charts(text) {\n\t// 文本\n\ttext = text.replace(/\\s/g, \"\");\n\tif (text) {\n\t\tcreatParent.children.push({\n\t\t\ttype: 3,\n\t\t\ttext,\n\t\t});\n\t}\n}\nfunction end(tag) {\n\t// 结束标签\n\tlet element = stack.pop();\n\tcreatParent = stack[stack.length - 1];\n\tif (creatParent) {\n\t\telement.parent = creatParent.tag;\n\t\tcreatParent.children.push(element);\n\t}\n}\nexport function parseHTML(html) {\n\twhile (html) {\n\t\t// 判断标签\n\t\tlet textEnd = html.indexOf(\"<\");\n\t\tif (textEnd == 0) {\n\t\t\t// 开始标签\n\t\t\tconst startTagMatch = parseStartTag();\n\t\t\tif (startTagMatch) {\n\t\t\t\tstart(startTagMatch.tagName, startTagMatch.attrs);\n\t\t\t}\n\t\t\t// 结束标签\n\t\t\tlet endTagMatch = html.match(endTag);\n\t\t\tif (endTagMatch) {\n\t\t\t\tadvance(endTagMatch[0].length);\n\t\t\t\tend(endTagMatch[1]);\n\t\t\t}\n\t\t}\n\t\tlet text;\n\t\tif (textEnd > 0) {\n\t\t\t// 文本\n\t\t\t// 获取文本内容\n\t\t\ttext = html.substring(0, textEnd);\n\t\t}\n\t\tif (text) {\n\t\t\tcharts(text);\n\t\t\tadvance(text.length);\n\t\t}\n\t}\n\tfunction parseStartTag() {\n\t\tconst start = html.match(startTagOpen);\n\t\tif (!start) return;\n\t\tlet match = {\n\t\t\ttagName: start[1],\n\t\t\tattrs: [],\n\t\t};\n\t\t// 删除开始标签\n\t\tadvance(start[0].length);\n\t\t// 获取属性\n\t\tlet attr;\n\t\tlet end;\n\t\twhile (\n\t\t\t!(end = html.match(startTagClose)) &&\n\t\t\t(attr = html.match(attribute))\n\t\t) {\n\t\t\tmatch.attrs.push({\n\t\t\t\tname: attr[1],\n\t\t\t\tvalue: attr[3] || attr[4] || attr[5],\n\t\t\t});\n\t\t\tadvance(attr[0].length);\n\t\t}\n\t\tif (end) {\n\t\t\tadvance(end[0].length);\n\t\t\treturn match;\n\t\t}\n\t}\n\tfunction advance(n) {\n\t\thtml = html.substring(n);\n\t}\n\tconsole.log(\"root\", root);\n\treturn root;\n}\n","/*\n * @Author: wzy\n * @Date: 2024-02-12 22:07:27\n * @LastEditTime: 2024-02-13 14:59:44\n * @LastEditors: wzy\n * @Description:\n * @FilePath: /myVue/src/compile/index.js\n */\n\n/* \n<div id=\"app\">\n    \n    <h1> hello word</h1>\n</div> \n*/\nimport { parseHTML } from \"./parseAst\";\n\nexport function compileToFunction(el) {\n\tlet ast = parseHTML(el);\n}\n","/*\n * @Author: wzy\n * @Date: 2024-02-03 17:16:22\n * @LastEditTime: 2024-02-12 22:14:13\n * @LastEditors: wzy\n * @Description:\n * @FilePath: /myVue/src/init.js\n */\nimport { compileToFunction } from \"./compile/index.js\";\nexport function initMixin(Vue) {\n\tVue.prototype._init = function (options) {\n\t\tlet vm = this;\n\t\tthis.$options = options;\n\t\t// 初始化状态\n\t\tconsole.log(vm);\n\t\t// 渲染模版 el\n\t\tif (vm.$options.el) {\n\t\t\tvm.$mount(vm.$options.el);\n\t\t}\n\t};\n\n\t// 创建 $mount\n\tVue.prototype.$mount = function (el) {\n\t\tlet vm = this;\n\t\tel = document.querySelector(el); // 获取元素\n\t\tlet options = vm.$options;\n\t\tif (!options.render) {\n\t\t\tlet template = options.template;\n\t\t\tif (!template && el) {\n\t\t\t\tel = el.outerHTML;\n\t\t\t\tconsole.log(el);\n\n\t\t\t\t// 变成ast语法树\n\n\t\t\t\tlet ast = compileToFunction(el);\n\t\t\t}\n\t\t}\n\t};\n}\n","/*\n * @Author: your name\n * @Date: 2024-02-03 10:45:00\n * @LastEditTime: 2024-02-03 17:39:01\n * @LastEditors: wzy\n * @Description:\n * @FilePath: /myVue/src/index.js\n * 可以输入预定的版权声明、个性签名、空行等\n */\n\nimport { initMixin } from \"./init\";\n\nfunction Vue(options) {\n\tthis._init(options);\n}\ninitMixin(Vue);\nexport default Vue;\n"],"names":["ncname","qnameCapture","concat","startTagOpen","RegExp","endTag","attribute","startTagClose","creatASTElement","tag","attrs","children","type","parent","root","creatParent","stack","start","element","push","charts","text","replace","end","pop","length","parseHTML","html","textEnd","indexOf","startTagMatch","parseStartTag","tagName","endTagMatch","match","advance","substring","attr","name","value","n","console","log","compileToFunction","el","initMixin","Vue","prototype","_init","options","vm","$options","$mount","document","querySelector","render","template","outerHTML"],"mappings":"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"}